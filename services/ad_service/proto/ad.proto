syntax = "proto3";
package ad;
option go_package = "78-pflops/services/ad_service/pb/ad_service/pb";

import "google/protobuf/wrappers.proto";

message Ad {
  string id = 1;
  string author_id = 2;
  string title = 3;
  string description = 4;
  int64 price = 5;
  string category_id = 6;
  string condition = 7; // NEW, USED, REFURBISHED
  repeated string image_urls = 8;
  double seller_rating = 9;
  int64 created_at = 10;
  int64 updated_at = 11;
}

message CreateAdRequest {
  string user_id = 1;
  string title = 2;
  string description = 3;
  int64 price = 4;
}

message CreateAdResponse { Ad ad = 1; }

message GetAdRequest { string id = 1; }
message GetAdResponse { Ad ad = 1; }

message ListAdsRequest {
  string text = 1;
  string category_id = 2;
  int64 price_min = 3;
  int64 price_max = 4;
  string condition = 5;
  int32 page = 6;
  int32 page_size = 7;
}

message ListAdsResponse {
  repeated Ad ads = 1;
  int32 total = 2;
  int32 page = 3;
  int32 page_size = 4;
}

message UpdateAdRequest {
  string ad_id = 1;
  string user_id = 2;
  google.protobuf.StringValue title = 3;       // optional
  google.protobuf.StringValue description = 4; // optional
  google.protobuf.Int64Value price = 5;        // optional
}

message UpdateAdResponse {}

message DeleteAdRequest { string ad_id = 1; string user_id = 2; }
message DeleteAdResponse {}

message AttachMediaRequest { string ad_id = 1; string media_id = 2; }
message AttachMediaResponse {}

message ImageUpload {
  bytes file_bytes = 1;
  string mime_type = 2;
  string file_name = 3;
}

message CreateAdWithImagesRequest {
  string user_id = 1;       // идентификатор пользователя (уже валидированный снаружи)
  string title = 2;
  string description = 3;
  int64 price = 4;
  repeated ImageUpload images = 5;
}

message CreateAdWithImagesResponse {
  Ad ad = 1;
}

service AdService {
  rpc CreateAd (CreateAdRequest) returns (CreateAdResponse);
  rpc GetAd (GetAdRequest) returns (GetAdResponse);
  rpc ListAds (ListAdsRequest) returns (ListAdsResponse);
  rpc UpdateAd (UpdateAdRequest) returns (UpdateAdResponse);
  rpc DeleteAd (DeleteAdRequest) returns (DeleteAdResponse);
  rpc AttachMedia (AttachMediaRequest) returns (AttachMediaResponse);
  rpc CreateAdWithImages (CreateAdWithImagesRequest) returns (CreateAdWithImagesResponse);
}
