events {
    worker_connections 1024;
}

http {
	# -------------------------------------------------
	# Proxy for gRPC‑UI front‑ends (plain‑text HTTP)
	# -------------------------------------------------
	upstream ad_ui { server ad_grpcui:8080; }
	upstream us_ui { server us_grpcui:8080; }
	upstream ms_ui { server ms_grpcui:8080; }

	# -------------------------------------------------
	# Optional: direct routing to the actual services
	# -------------------------------------------------
	upstream ad_service   { server ad_service_app:50051; }
	upstream user_service { server user_service_app:50052; }
	upstream media_service { server media-service:50053; }

	server {
		listen 80;
		server_name _;

		# ---- gRPC‑UI endpoints ----
		location /ad-ui/ {
			proxy_pass http://ad_ui/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		location /user-ui/ {
			proxy_pass http://us_ui/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		location /media-ui/ {
			proxy_pass http://ms_ui/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		# ---- API routing (example) ----
		location /api/ad/ {
			proxy_pass http://ad_service/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		location /api/user/ {
			proxy_pass http://user_service/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		location /api/media/ {
			proxy_pass http://media_service/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

	}
}
